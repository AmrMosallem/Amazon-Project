<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="shortcut icon"
      href="./images/Sicons-Basic-Round-Social-Amazon.512.png"
      type="image/x-icon"
    />
    <link rel="stylesheet" href="./styles/pages/checkout.css" />
    <title>Cart</title>
    <style>
      * {
        padding: 0;
        margin: 0;
        box-sizing: border-box;
      }
      img {
        width: 100%;
      }
      a {
        text-decoration: none;
        color: inherit;
      }
      .hide {
        display: none !important;
      }
      .show {
        display: block !important;
      }
      body {
        font-family: Arial, sans-serif;
      }
      .container {
        padding: 10px;
        width: 90%;
        margin: auto;
        max-width: 1099px;
      }
      /* navbar */
      nav {
        position: fixed;
        width: 90%;
        left: 50%;
        transform: translateX(-50%);
        z-index: 5;
        background: #fff;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        max-width: 1099px;
        .checkout {
          letter-spacing: -1px;
          span {
            letter-spacing: 0;
            color: #207685;
          }
        }
      }
      /* main content */
      .card {
        border: 1px solid #dcd8d8;
        border-radius: 10px;
        padding: 20px;
      }
      main {
        padding-top: 50px;
        display: flex;
        justify-content: space-between;
        position: relative;
        overflow: hidden;
        .cart-items {
          width: 67%;
          .card {
            margin-bottom: 20px;
            .delivery-date {
              color: #007600;
              margin-bottom: 20px;
            }
            .card-body {
              display: flex;
              justify-content: space-between;
              gap: 20px;
              .img {
                width: 100px;
              }
              .detail-product {
                > * {
                  margin-bottom: 10px;
                }
                .price {
                  color: #ab0202;
                  font-weight: bold;
                }
                .quantity {
                  display: flex;
                  align-items: center;
                  font-weight: 500;
                  gap: 5px;
                  .decrease,
                  .increase {
                    padding: 2px 8px;
                    background: #eee;
                    font-size: 20px;
                    cursor: pointer;
                  }
                }
              }
              .delivery-options {
                .options {
                  .option {
                    display: flex;
                    gap: 10px;
                    margin: 10px 0;
                    input {
                      width: 18px;
                      cursor: pointer;
                    }
                    label {
                      width: 150px;
                      .date {
                        color: #007600;
                        font-weight: bold;
                      }
                      .cost {
                        color: gray;
                        font-size: 14px;
                      }
                    }
                  }
                }
              }
            }
          }
        }
        .overlay {
          position: fixed;
          right: 0;
          left: 0;
          top: 0;
          bottom: 0;
          z-index: 5;
          background-color: #0000009c;
        }
        .summary-order-icon {
          position: fixed;
          right: -10px;
          cursor: pointer;
          z-index: 10;
        }
        .summary-order {
          position: relative;
          width: 30%;
          h2 {
            padding-bottom: 15px;
          }
          .card {
            position: fixed;
            background-color: #fff;
          }
          .item {
            display: flex;
            justify-content: space-between;
            padding-bottom: 10px;
          }
          hr {
            border: 1px solid #dcd8d8;
          }
          .cost hr {
            margin: 8px 0 0;
          }
          .end-order {
            .item {
              color: #ab0202;
              font-weight: bold;
              font-size: 18px;
              margin: 10px 0 0;
            }
            .paypal {
              margin: 10px 0;
              display: flex;
              align-items: center;
              gap: 5px;
              cursor: pointer;
              input {
                padding: 22px;
                width: 18px;
                height: 18px;
              }
            }
            .create-order {
              padding: 10px;
              text-align: center;
              background-color: #ffd500;
              border-radius: 10px;
              cursor: pointer;
              filter: drop-shadow(0px 0 3px #00000098);
              transition: 0.2s;
              &:hover {
                background-color: #ffc107;
              }
            }
          }
        }
      }
      /* mobile media */
      @media (max-width: 766px) {
        .desktop {
          display: none;
        }
        .mobile {
          display: block;
        }
        .logo img {
          width: 1.5rem;
        }
        .cart-items {
          width: 95% !important;
          .card-body {
            flex-direction: column;
            align-items: center;
          }
        }
        .summary-order {
          position: fixed !important;
          right: -100%;
          z-index: 10;
          width: 82% !important;
          &.show {
            right: 11%;
          }
          .card {
            position: relative !important;
          }
        }
      }
      /* desktop media */
      @media (min-width: 767px) {
        .desktop {
          display: block;
        }
        .mobile {
          display: none;
        }
        .logo img {
          width: 6.25rem;
        }
      }
    </style>
  </head>
  <body>
    <nav>
      <a href="./amazon.html" class="logo">
        <img class="desktop" src="./images/amazon-logo.png" alt="" />
        <img class="mobile" src="./images/amazon-mobile-logo.png" alt="" />
      </a>
      <h2 class="checkout">
        Checkout (<span><span class="count">0</span> itmes</span>)
      </h2>
      <div class="lock-icon">
        <img src="./images/icons/checkout-lock-icon.png" width="100%" alt="" />
      </div>
    </nav>
    <div class="container">
      <main>
        <!-- show cart items -->
        <div class="cart-items">
          <div class="card">
            <div class="delivery-date">
              <h2>Delivery date: <span>Tuesday, May 2</span></h2>
            </div>
            <div class="card-body">
              <div class="img">
                <img
                  src="./images/products/6-piece-white-dinner-plate-set.jpg"
                  alt=""
                />
              </div>
              <div class="detail-product">
                <h4 class="name-product">Intermediate Size Basketball</h4>
                <div class="price">$<span>20.95</span></div>
                <div class="quantity">
                  Quantity:
                  <span class="decrease">-</span>
                  <span class="count">1</span>
                  <span class="increase">+</span>
                </div>
              </div>
              <div class="delivery-options">
                <h4>Choose a delivery option:</h4>
                <div class="options">
                  <div class="option">
                    <input type="radio" name="date" id="slowly" />
                    <label for="slowly">
                      <div class="date">Monday, May 8</div>
                      <div class="cost"><span>FREE</span> Shipping</div>
                    </label>
                  </div>
                  <div class="option">
                    <input type="radio" name="date" id="medium" />
                    <label for="medium">
                      <div class="date">Friday, May 2</div>
                      <div class="cost">$<span>4.99</span> - Shipping</div>
                    </label>
                  </div>
                  <div class="option">
                    <input type="radio" name="date" id="fast" />
                    <label for="fast">
                      <div class="date">Saturday, April 29</div>
                      <div class="cost">$<span>9.99</span> - Shipping</div>
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="delivery-date">
              <h2>Delivery date: <span>Tuesday, May 2</span></h2>
            </div>
            <div class="card-body">
              <div class="img">
                <img
                  src="./images/products/6-piece-white-dinner-plate-set.jpg"
                  alt=""
                />
              </div>
              <div class="detail-product">
                <h4 class="name-product">Intermediate Size Basketball</h4>
                <div class="price">$<span>20.95</span></div>
                <div class="quantity">
                  Quantity:
                  <span class="decrease">-</span>
                  <span class="count">1</span>
                  <span class="increase">+</span>
                </div>
              </div>
              <div class="delivery-options">
                <h4>Choose a delivery option:</h4>
                <div class="options">
                  <div class="option">
                    <input type="radio" name="date" id="slowly" />
                    <label for="slowly">
                      <div class="date">Monday, May 8</div>
                      <div class="cost"><span>FREE</span> Shipping</div>
                    </label>
                  </div>
                  <div class="option">
                    <input type="radio" name="date" id="medium" />
                    <label for="medium">
                      <div class="date">Friday, May 2</div>
                      <div class="cost">$<span>4.99</span> - Shipping</div>
                    </label>
                  </div>
                  <div class="option">
                    <input type="radio" name="date" id="fast" />
                    <label for="fast">
                      <div class="date">Saturday, April 29</div>
                      <div class="cost">$<span>9.99</span> - Shipping</div>
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- sidebar icon -->
        <div
          class="summary-order-icon mobile"
          title="show summary order"
          onclick="showSummary()"
        >
          <?xml version="1.0" encoding="utf-8"?><!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
          <svg
            fill="#000000"
            width="30px"
            height="30px"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              fill-rule="evenodd"
              d="M11.28 9.53L8.81 12l2.47 2.47a.75.75 0 11-1.06 1.06l-3-3a.75.75 0 010-1.06l3-3a.75.75 0 111.06 1.06z"
            />
            <path
              fill-rule="evenodd"
              d="M3.75 2A1.75 1.75 0 002 3.75v16.5c0 .966.784 1.75 1.75 1.75h16.5A1.75 1.75 0 0022 20.25V3.75A1.75 1.75 0 0020.25 2H3.75zM3.5 3.75a.25.25 0 01.25-.25H15v17H3.75a.25.25 0 01-.25-.25V3.75zm13 16.75v-17h3.75a.25.25 0 01.25.25v16.5a.25.25 0 01-.25.25H16.5z"
            />
          </svg>
        </div>
        <!-- overlay -->
        <div class="overlay hide" onclick="showSummary()"></div>
        <!-- summary of order -->
        <div class="summary-order">
          <div class="card">
            <h2>Order Summary</h2>
            <div class="cost-details">
              <div class="cost-product">
                <div class="item">
                  <div class="items">Items (<span>2</span>):</div>
                  <div class="cost">$<span>28.89</span></div>
                </div>
                <div class="item">
                  <div class="shipping">Shipping & handling:</div>
                  <div class="cost">
                    $<span>28.89</span>
                    <hr />
                  </div>
                </div>
              </div>
              <div class="tax">
                <div class="item">
                  <div class="before-tax">Total before tax:</div>
                  <div class="cost">$<span>28.89</span></div>
                </div>
                <div class="item">
                  <div class="estimated-tax">Estimated tax (10%):</div>
                  <div class="cost">$<span>28.89</span></div>
                </div>
              </div>
            </div>
            <hr />
            <div class="end-order">
              <div class="item">
                <div class="total">Order total:</div>
                <div class="cost">$<span>37.99</span></div>
              </div>
              <div class="paypal">
                <label for="pay">Use PayPal</label>
                <input type="checkbox" id="pay" />
              </div>
              <div class="create-order">
                <a href="./orders.html">Place your order</a>
              </div>
              <!--  -->
            </div>
          </div>
        </div>
      </main>
    </div>
  </body>
  <script src="./data/products.js"></script>
  <!-- <script src="./scripts/shared/test-functions.js"></script> -->
  <script>
    let overlay = document.querySelector(".overlay");
    let summaryOrder = document.querySelector(".summary-order");
    let cartItemsContainer = document.querySelector(".cart-items");
    let cartDataProducts = [];
    const showSummary = () => {
      summaryOrder.classList.toggle("show");
      overlay.classList.toggle("hide");
    };
    // setTestCartToLocalStorage();
    // get data of cart from localStorage, save it in cartDataProducts var
    let cartItemsStorage = JSON.parse(localStorage.getItem("cart"));
    console.log(cartItemsStorage);
    console.log(products);
    for (let i = 0; i < cartItemsStorage.length; i++) {
      let id = cartItemsStorage[i].productId;
      cartDataProducts.push(products.find((e, i) => e.id == id));
      cartDataProducts[i].quantity = cartItemsStorage[i].quantity;
      cartDataProducts[i].deliveryOptionId =
        cartItemsStorage[i].deliveryOptionId;
    }
    console.log(cartDataProducts);
    // set order and save in localStorage
    const setOrder = () => {
      fetch("https://supersimplebackend.dev/orders", {
        method: "POST",
        body: JSON.stringify({
          cart: cartItemsStorage,
        }),
      })
        .then((res) => res.json())
        .then((data) => {
          console.log(data);
        })
        .catch((error) => console.log(err));
    };

    const showItems = () => {
      // calc date of delivery
      let d = new Date();
      let day = d.getDate();
      d.setDate(day + 8);
      let dateFree = d.toLocaleDateString("en-ca", {
        weekday: "short",
        day: "2-digit",
        month: "long",
      });
      d.setDate(day + 3);
      let dateMed = d.toLocaleDateString("en-ca", {
        weekday: "short",
        day: "2-digit",
        month: "long",
      });
      d.setDate(day + 1);
      let dateFast = d.toLocaleDateString("en-ca", {
        weekday: "short",
        day: "2-digit",
        month: "long",
      });
      cartItemsContainer.innerHTML = "";
      cartDataProducts.forEach((ele, i) => {
        cartItemsContainer.innerHTML += `
          <div class="card">
            <div class="delivery-date">
              <h2>Delivery date: <span>Tuesday, May 2</span></h2>
            </div>
            <div class="card-body">
              <div class="img">
                <img
                  src="${ele.image}"
                  alt=""
                />
              </div>
              <div class="detail-product">
                <h4 class="name-product">${ele.name}</h4>
                <div class="price">$<span>${(ele.priceCents / 100).toFixed(
                  2
                )}</span></div>
                <div class="quantity">
                  Quantity:
                  <span class="decrease" onclick="decrease(${i})">-</span>
                  <span class="count">${cartItemsStorage[i].quantity}</span>
                  <span class="increase" onclick="increase(${i})">+</span>
                </div>
              </div>
              <div class="delivery-options">
                <h4>Choose a delivery option:</h4>
                <div class="options">
                  <div class="option">
                    <input type="radio" value="1" name="date${i}" id="slowly_${i}" />
                    <label for="slowly_${i}">
                      <div class="date">${dateFree}</div>
                      <div class="cost"><span>FREE</span> Shipping</div>
                    </label>
                  </div>
                  <div class="option">
                    <input type="radio" value="2" name="date${i}" id="medium_${i}" />
                    <label for="medium_${i}">
                      <div class="date">${dateMed}</div>
                      <div class="cost">$<span>4.99</span> - Shipping</div>
                    </label>
                  </div>
                  <div class="option">
                    <input type="radio" value="3" name="date${i}" id="fast_${i}" />
                    <label for="fast_${i}">
                      <div class="date">${dateFast}</div>
                      <div class="cost">$<span>9.99</span> - Shipping</div>
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>`;
      });
    };
    const decrease = (i) => {
      if (cartItemsStorage[i].quantity <= 1) return;
      cartDataProducts[i].quantity--;
      cartItemsStorage[i].quantity--;
      localStorage.setItem("cart", JSON.stringify(cartItemsStorage));
      showItems();
      calcSummeryOrder();
    };
    const increase = (i) => {
      cartItemsStorage[i].quantity++;
      cartDataProducts[i].quantity++;
      localStorage.setItem("cart", JSON.stringify(cartItemsStorage));
      showItems();
      calcSummeryOrder();
    };
    const calcSummeryOrder = () => {
      // get count of items
      document.querySelector(
        ".summary-order .cost-details .items span"
      ).innerHTML = cartDataProducts.length;
      // calc total cost of items without tax and delivery
      let sum = 0;
      for (let i = 0; i < cartDataProducts.length; i++) {
        sum +=
          (cartDataProducts[i].priceCents * cartDataProducts[i].quantity) / 100;
      }
      document.querySelector(
        ".summary-order .cost-details .items+ .cost span"
      ).innerHTML = sum.toFixed(2);
      // calc delivery cost
      let allInputOfDelivery = [];
      for (let i = 0; i < cartDataProducts.length; i++) {
        console.log(document.getElementsByName(`date${i}`));
        allInputOfDelivery.push(document.getElementsByName(`date${i}`));
      }
      console.log(allInputOfDelivery);
      let totalDeliveryCost = 0;
      const utiltyForShiping = () => {
        totalDeliveryCost = 0;
        allInputOfDelivery.forEach((e, i) => {
          e.forEach((e, j) => {
            if (cartItemsStorage[i].deliveryOptionId == e.value) {
              if (e.value == 2) totalDeliveryCost += 4.99;
              else if (e.value == 3) totalDeliveryCost += 9.99;
            }
          });
        });
        document.querySelector(
          ".summary-order .cost-details .shipping + .cost span"
        ).innerHTML = totalDeliveryCost.toFixed(2);
        document.querySelector(
          ".summary-order .tax .before-tax + .cost span"
        ).innerHTML = (totalDeliveryCost + sum).toFixed(2);
        document.querySelector(
          ".summary-order .tax .estimated-tax + .cost span"
        ).innerHTML = ((totalDeliveryCost + sum) * 0.1).toFixed(2);
        document.querySelector(
          ".summary-order .end-order .total + .cost span"
        ).innerHTML = (
          totalDeliveryCost +
          sum +
          (totalDeliveryCost + sum) * 0.1
        ).toFixed(2);
      };
      allInputOfDelivery.forEach((e, i) => {
        e.forEach((e, j) => {
          if (cartItemsStorage[i].deliveryOptionId == e.value) {
            e.checked = true;
            utiltyForShiping();
          }
          e.addEventListener("click", () => {
            cartItemsStorage[i].deliveryOptionId = e.value;
            utiltyForShiping();
            localStorage.setItem("cart", JSON.stringify(cartItemsStorage));
          });
        });
      });
    };
    // Fire EL Functions
    showItems();
    calcSummeryOrder();
    // setOrder();
  </script>
</html>
